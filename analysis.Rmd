Race and Threat Priming 
Nick Camp, Takuya Sawaoka, Erica Yoon
========================================================

This document contains signal detection analyses for three experiments: *Weapons Bias* (Study I), *Snake Bias* (Study II), *Door/Window Study* (Study III) and *Control Study* (Study IV).  

Data Preprocessing
------------------

```{r, include=FALSE}
rm(list = ls())
library(car)
library(lme4)
library(lmerTest)
library(ggplot2)
library(bootstrap)
library(tidyr)
source("helper/helper.R")
theme_set(theme_bw())

d <- read.csv("data/consolidated_data.csv")
```

Participant exclusion? Do we do this? Accuracies are low.

```{r}
good_subs <- d %>% 
  group_by(workerid, expt) %>% 
  summarise(accuracy = mean(accuracy))

qplot(accuracy, data=good_subs)
```

Vanilla Analyses
----------------

First consolidate across subjects. 

```{r}
ms.acc <- d %>% 
  filter(responded == 1) %>%
  group_by(expt, target, prime, workerid) %>%
  summarise(accuracy = mean(accuracy)) %>%
  group_by(expt, target, prime, add=FALSE) %>%
  summarise(acc.cih = ci.high(accuracy), 
            acc.cil = ci.low(accuracy), 
            accuracy = mean(accuracy), 
            n = n())

qplot(prime, accuracy, fill = target, 
      geom = "bar", position = "dodge", stat = "identity",
      data = ms.acc) + 
  geom_linerange(aes(ymin = accuracy - acc.cil, 
                     ymax = accuracy + acc.cih), 
                 position = position_dodge(width = .9)) + 
  facet_grid(.~expt, scales="free_x") + 
  geom_hline(yintercept=.5, lty=2)
```

Then reaction time. Should we filter only correct trials? 

```{r}
ms.rt <- d %>% 
  filter(responded == 1 & accuracy == 1) %>%
  group_by(expt, target, prime, workerid) %>%
  summarise(rt = mean(rt)) %>%
  group_by(expt, target, prime, add=FALSE) %>%
  summarise(rt.cih = ci.high(rt), 
            rt.cil = ci.low(rt),
            rt = mean(rt), 
            n = n())

qplot(prime, rt, fill = target, 
      geom = "bar", position = "dodge", stat = "identity",
      data = ms) + 
  geom_linerange(aes(ymin = rt - rt.cil, 
                     ymax = rt + rt.cih), 
                 position = position_dodge(width = .9)) + 
  facet_grid(.~expt, scales="free_x")
```


Signal Detection
----------------

For each subject, we calculate bias and sensitivity for BLACK and WHITE targets: 

* Hit is defined as correctly identifying GUN after seeing GUN (accuracy rate for GUN trials)
* False Alarm is defined as incorrectly responding GUN after seeing TOOL (1-accuracy rate for TOOL trials)

```{r}
sdt <- d %>%
  mutate(hit = target == "threat" & accuracy == 1, 
         miss = target == "threat" & accuracy == 0, 
         cr = target == "neutral" & accuracy == 1, 
         fa = target == "neutral" & accuracy == 0) %>%
  group_by(expt, prime, workerid) %>%
  summarise(hits = mean(c(hit, 1)),
            fas = mean(c(fa, 1))) %>%
  mutate(dprime = dprime(hits, fas),
         bias = beta(hits, fas), 
         criterion = criterion(hits, fas)) %>%
  gather(signal, value, dprime, bias, criterion) %>%
  group_by(expt, prime, signal) %>%
  summarise(cih = ci.high(value), 
            cil = ci.low(value), 
            value = mean(value, na.rm=TRUE))
  
quartz()
qplot(prime, value, fill = prime, 
      geom = "bar", position = "dodge", stat = "identity",
      data = sdt) + 
  geom_linerange(aes(ymin = value - cil, 
                     ymax = value + cih), 
                 position = position_dodge(width = .9)) + 
  facet_grid(signal~expt, scales="free")
```